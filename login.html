<!-- login.html -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تسجيل الدخول</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>body{background:#f8f9fa}.login-box{max-width:400px;margin:100px auto;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,.1)}</style>
</head>
<body>
  <div class="container">
    <div class="login-box bg-white">
      <h2 class="text-center mb-4">تسجيل الدخول 🔒</h2>
      <div class="mb-3">
        <input type="text" id="username" class="form-control" placeholder="اسم المستخدم">
      </div>
      <div class="mb-3">
        <input type="password" id="password" class="form-control" placeholder="كلمة المرور">
      </div>
      <button class="btn btn-primary w-100" onclick="login()">دخول</button>
    </div>
  </div>

  <script>
    const SECRET_KEY = "smart_era_secret_@2024";

    function initDefaultUsers() {
      if (!localStorage.getItem('users')) {
        const defaultUsers = [{ username:'hr', password:'100200300', permissions:['manage_users'] }];
        localStorage.setItem('users', CryptoJS.AES.encrypt(JSON.stringify(defaultUsers), SECRET_KEY).toString());
      }
    }

    function login() {
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      if (!u||!p) return alert('يرجى إدخال جميع البيانات');
      try {
        const encrypted = localStorage.getItem('users');
        const users = JSON.parse(CryptoJS.AES.decrypt(encrypted, SECRET_KEY).toString(CryptoJS.enc.Utf8));
        const user = users.find(x=>x.username===u&&x.password===p);
        if (!user) throw 'بيانات الدخول غير صحيحة';
        sessionStorage.setItem('auth', CryptoJS.AES.encrypt(JSON.stringify(user), SECRET_KEY).toString());
        window.location.href = 'index.html';
      } catch (e) {
        alert(e);
      }
    }
    initDefaultUsers();
  </script>
</body>
</html>

<!-- manage-users.html -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إدارة المستخدمين</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body class="p-4">
  <h2>إدارة المستخدمين</h2>
  <div class="mb-3">
    <input id="newUser" class="form-control d-inline-block w-auto" placeholder="اسم المستخدم">
    <input id="newPass" type="password" class="form-control d-inline-block w-auto" placeholder="كلمة المرور">
    <label class="form-check-label me-2"><input type="checkbox" id="permManage" class="form-check-input"> صلاحية إدارة المستخدمين</label>
    <button class="btn btn-success" onclick="addUser()">إضافة مستخدم</button>
  </div>
  <table class="table table-bordered">
    <thead><tr><th>المستخدم</th><th>كلمة المرور</th><th>صلاحيات</th><th>إجراء</th></tr></thead>
    <tbody id="userTable"></tbody>
  </table>
  <button class="btn btn-secondary" onclick="logout()">تسجيل خروج</button>

  <script>
    const SECRET_KEY='smart_era_secret_@2024';
    let users = [];
    function loadUsers(){
      try{
        const enc=localStorage.getItem('users');
        users=JSON.parse(CryptoJS.AES.decrypt(enc,SECRET_KEY).toString(CryptoJS.enc.Utf8));
      }catch{users=[]}
      render();
    }
    function saveUsers(){
      localStorage.setItem('users', CryptoJS.AES.encrypt(JSON.stringify(users), SECRET_KEY).toString());
    }
    function render(){
      const tbody=document.getElementById('userTable'); tbody.innerHTML='';
      users.forEach((u,i)=>{
        tbody.innerHTML+=`<tr><td>${u.username}</td><td>${u.password}</td><td>${u.permissions.join(', ')}</td><td><button class='btn btn-danger btn-sm' onclick='deleteUser(${i})'>حذف</button></td></tr>`;
      });
    }
    function addUser(){
      const u=document.getElementById('newUser').value.trim();
      const p=document.getElementById('newPass').value.trim();
      const perm=document.getElementById('permManage').checked?['manage_users']:[];
      if(!u||!p) return alert('املأ الحقول');
      if(users.find(x=>x.username===u)) return alert('المستخدم موجود');
      users.push({username:u,password:p,permissions:perm}); saveUsers(); render();
    }
    function deleteUser(i){users.splice(i,1); saveUsers(); render();}
    function logout(){ sessionStorage.removeItem('auth'); location.href='login.html'; }
    // التحقق من صلاحية الوصول
    (function(){
      const auth=sessionStorage.getItem('auth');
      if(!auth) return location.href='login.html';
      const user=JSON.parse(CryptoJS.AES.decrypt(auth,SECRET_KEY).toString(CryptoJS.enc.Utf8));
      if(!user.permissions.includes('manage_users')) location.href='index.html';
    })();
    loadUsers();
  </script>
</body>
</html>
