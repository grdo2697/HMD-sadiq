<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- ... (بقية الهيد بدون تغيير) ... -->
</head>
<body>
  <!-- ... (بقية البودي بدون تغيير) ... -->

  <script>
    // تحديث رابط السكربت مع الترميز الصحيح
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw4eBX4H2On6sWKaWhL4ZHy0j7qqiUEB6DcrO_muHBPMjU2AuS7Udo8h2J3afa7OE67A/exec?sheet=موظفين%20الحريه%20تقديم';

    let allData = [];

    async function fetchData() {
      showLoading();
      try {
        const response = await fetch(SCRIPT_URL);
        if (!response.ok) throw new Error('خطأ في الاتصال بالسيرفر: ' + response.status);
        
        const result = await response.json();
        if (result.error) throw new Error(result.error);
        
        allData = result.data || [];
        if (allData.length === 0) showEmptyMessage();
        
        populateTypeFilter();
        renderTable(allData);
        
      } catch (error) {
        showError(error.message);
        console.error('تفاصيل الخطأ:', error);
      } finally {
        hideLoading();
      }
    }

    function renderTable(data) {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      
      if (data.length === 0) return showEmptyMessage();

      data.forEach(item => {
        const status = item.الحالة || 'قيد الانتظار';
        const statusClass = `status-${status.replace(/ /g, '_')}`;
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td data-label="الاسم">${item.الاسم || '—'}</td>
          <td data-label="نوع الطلب">${item.نوع_الطلب || '—'}</td>
          <td data-label="الحالة" class="${statusClass}">${status}</td>
          <td data-label="الموظف المسؤول">${item.الموظف_المسؤول || '—'}</td>
          <td data-label="تاريخ التقديم">${item.تاريخ_التقديم || '—'}</td>
          <td data-label="رقم الهاتف">${item.رقم_الهاتف || '—'}</td>
          <td data-label="التحصيل الدراسي">${item.التحصيل_الدراسي || '—'}</td>
          <td data-label="العنوان">${item.العنوان || '—'}</td>
          <td data-label="المواليد">${item.المواليد || '—'}</td>
          <td data-label="الراتب">${item.الراتب_المتفق_عليه || '—'}</td>
          <td data-label="النقل">${item.النقل || '—'}</td>
          <td data-label="وقت العمل">${item.وقت_المباشرة || '—'}</td>
          <td data-label="الشركة السابقة">${item.الشركة_السابقة || '—'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // تحديث دالة التصفية
    function populateTypeFilter() {
      const select = document.getElementById('filter-type');
      const types = [...new Set(allData.map(item => item.نوع_الطلب))].filter(Boolean).sort();
      select.innerHTML = '<option value="">كل أنواع الطلب</option>';
      types.forEach(type => {
        select.innerHTML += `<option value="${type}">${type}</option>`;
      });
    }

    // إضافة دوال الرسائل
    function showEmptyMessage() {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = `
        <tr>
          <td colspan="13" class="no-data">لا توجد طلبات متاحة حالياً</td>
        </tr>
      `;
    }

    function showError(message) {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = `
        <tr>
          <td colspan="13" class="error">${message}</td>
        </tr>
      `;
    }

    // ... (بقية الدوال بدون تغيير) ...
  </script>
</body>
</html>
