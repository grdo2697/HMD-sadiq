<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>إدارة المستخدمين</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet>
  <style>
    /* نفس أنماط index.html مع تعديلات طفيفة */
    :root {
      --primary: #0ea5e9;
      --danger: #e74c3c;
      --success: #2ecc71;
    }

    .user-form {
      background: rgba(255,255,255,0.9);
      padding: 1.5rem;
      border-radius: 15px;
      margin-bottom: 2rem;
    }

    .permissions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <script>
    // التحقق من صلاحية المدير
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser || currentUser.username !== "hr") {
      alert("غير مصرح بالدخول!");
      window.location.href = "login.html";
    }
  </script>

  <button class="logout-btn" onclick="logout()">🚪 تسجيل الخروج</button>
  
  <div class="container">
    <h1>👥 إدارة المستخدمين</h1>
    
    <div class="user-form">
      <h3>➕ إضافة مستخدم جديد</h3>
      <input type="text" id="newUsername" placeholder="اسم المستخدم">
      <input type="password" id="newPassword" placeholder="كلمة المرور">
      
      <div class="permissions-grid">
        <label><input type="checkbox" id="perm1"> عرض البيانات</label>
        <label><input type="checkbox" id="perm2"> التصدير</label>
        <label><input type="checkbox" id="perm3"> إدارة المستخدمين</label>
      </div>
      
      <button onclick="addUser()">حفظ</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>اسم المستخدم</th>
          <th>الصلاحيات</th>
          <th>الإجراءات</th>
        </tr>
      </thead>
      <tbody id="usersList"></tbody>
    </table>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem("users")) || [];
    
    // عرض المستخدمين
    function renderUsers() {
      const tbody = document.getElementById("usersList");
      tbody.innerHTML = "";
      
      users.forEach((user, index) => {
        const row = `
          <tr>
            <td>${user.username}</td>
            <td>${user.permissions.join("، ")}</td>
            <td>
              <button onclick="editUser(${index})">✏️ تعديل</button>
              <button onclick="deleteUser(${index})" style="background: var(--danger)">🗑️ حذف</button>
            </td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
    }

    // إضافة مستخدم جديد
    function addUser() {
      const newUser = {
        username: document.getElementById("newUsername").value,
        password: document.getElementById("newPassword").value,
        permissions: []
      };

      if (document.getElementById("perm1").checked) newUser.permissions.push("عرض البيانات");
      if (document.getElementById("perm2").checked) newUser.permissions.push("التصدير");
      if (document.getElementById("perm3").checked) newUser.permissions.push("إدارة المستخدمين");

      users.push(newUser);
      localStorage.setItem("users", JSON.stringify(users));
      renderUsers();
    }

    // تعديل المستخدم
    function editUser(index) {
      const user = users[index];
      document.getElementById("newUsername").value = user.username;
      document.getElementById("newPassword").value = user.password;
      
      // تحديد الصلاحيات
      document.getElementById("perm1").checked = user.permissions.includes("عرض البيانات");
      document.getElementById("perm2").checked = user.permissions.includes("التصدير");
      document.getElementById("perm3").checked = user.permissions.includes("إدارة المستخدمين");
      
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      renderUsers();
    }

    // حذف المستخدم
    function deleteUser(index) {
      const deletedUser = users[index];
      
      if (deletedUser.username === currentUser.username) {
        logout();
      }
      
      users.splice(index, 1);
      localStorage.setItem("users", JSON.stringify(users));
      renderUsers();
    }

    // تسجيل الخروج
    function logout() {
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
    }

    // التحميل الأولي
    renderUsers();
  </script>
</body>
</html>
