<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0-crypto-js.js"></script>
</head>
<body>
  <header>
    <h1>ุฅุฏุงุฑุฉ ุงูููุธููู</h1>
  </header>

  <main>
    <button id="viewRatingsBtn" style="display: none;" onclick="viewRatings()">ุนุฑุถ ุงูุชููููุงุช ๐</button>
    <button id="excelBtn" style="display: none;" onclick="downloadExcel()">ุชูุฒูู Excel ๐ฅ</button>
    <button id="manageUsersBtn" style="display: none;" onclick="manageUsers()">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู ๐๏ธ</button>

    <h2>ูุงุฆูุฉ ุงูููุธููู</h2>
    <ul id="employeeList"></ul>
    
    <footer>
      <p>&copy; <span id="year"></span> ุฌููุน ุงูุญููู ูุญููุธุฉ</p>
    </footer>
  </main>

  <script>
    const SECRET_KEY = "smart_era_secret_@2024";
    const SESSION_KEY = "auth";
    let allEmployees = [];

    // ุฏุงูุฉ ูู ุงูุชุดููุฑ ูุฌูุณุฉ ุงููุณุชุฎุฏู
    function decryptSession() {
      try {
        const encryptedSession = sessionStorage.getItem(SESSION_KEY);
        if (!encryptedSession) throw new Error('ุงูุฌูุณุฉ ููุชููุฉ ุฃู ุบูุฑ ููุฌูุฏุฉ');
        
        const bytes = CryptoJS.AES.decrypt(encryptedSession, SECRET_KEY);
        const sessionData = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
        
        if (!sessionData?.permissions?.includes('view')) {
          throw new Error('ูุง ุชููู ุตูุงุญูุฉ ุงููุตูู');
        }
        
        return sessionData;
      } catch (error) {
        logout();
        return null;
      }
    }

    // ุฏุงูุฉ ููุชุญูู ูู ุงูุตูุงุญูุงุช ูุนุฑุถ ุงูุฃุฒุฑุงุฑ ุจูุงุกู ุนูููุง
    function verifyPermissions() {
      const session = decryptSession();
      if (!session) return;

      const isAdmin = session.user === 'hradmin';
      const canViewRatings = session.permissions.includes("๐ ุนุฑุถ ุงูุชููููุงุช");

      // ุนุฑุถ ุงูุฃุฒุฑุงุฑ ุญุณุจ ุงูุตูุงุญูุงุช
      document.getElementById('excelBtn').style.display = isAdmin ? 'inline-block' : 'none';
      document.getElementById('manageUsersBtn').style.display = isAdmin ? 'inline-block' : 'none';
      document.getElementById('viewRatingsBtn').style.display = canViewRatings ? 'inline-block' : 'none';
    }

    // ุฏุงูุฉ ูุนุฑุถ ุงูุชููููุงุช
    function viewRatings() {
      alert("ุนุฑุถ ุงูุชููููุงุช");
      // ููุง ุชุถูู ุงูููุฏ ุงูุฎุงุต ุจุนุฑุถ ุงูุชููููุงุช
    }

    // ุฏุงูุฉ ูุชูุฒูู ููู Excel
    function downloadExcel() {
      alert("ุชูุฒูู Excel");
      // ููุง ุชุถูู ุงูููุฏ ุงูุฎุงุต ุจุชูุฒูู ููู Excel
    }

    // ุฏุงูุฉ ูุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
    function manageUsers() {
      alert("ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู");
      // ููุง ุชุถูู ุงูููุฏ ุงูุฎุงุต ุจุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู
    }

    // ุฏุงูุฉ ูุฌูุจ ุจูุงูุงุช ุงูููุธููู
    function fetchEmployees() {
      fetch("https://example.com/employees")  // ุถุน ููุง ุงูุฑุงุจุท ุงูุตุญูุญ ูุจูุงูุงุช ุงูููุธููู
        .then(response => response.json())
        .then(data => {
          allEmployees = data;
          displayEmployees();
        })
        .catch(error => console.error("ุฎุทุฃ ูู ุฌูุจ ุงูุจูุงูุงุช: ", error));
    }

    // ุฏุงูุฉ ูุนุฑุถ ุจูุงูุงุช ุงูููุธููู
    function displayEmployees() {
      const employeeList = document.getElementById("employeeList");
      employeeList.innerHTML = "";

      allEmployees.forEach(employee => {
        const li = document.createElement("li");
        li.textContent = `${employee.name} - ${employee.position}`;
        employeeList.appendChild(li);
      });
    }

    // ุชุงุจุน ุชูููุฐ ุงูุชูุงุจุน ุนูุฏ ุชุญููู ุงูุตูุญุฉ
    window.onload = () => {
      verifyPermissions();
      fetchEmployees();
      document.getElementById("year").textContent = new Date().getFullYear();
    };
  </script>
</body>
</html>
